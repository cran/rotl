<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="David Winter" />

<meta name="date" content="2016-02-01" />

<title>Using the Open Tree synthesis in a comparative analysis</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css;charset=utf-8,body%7Bbackground%2Dcolor%3A%23fff%3Bmargin%3A1emauto%3Bmax%2Dwidth%3A700px%3Boverflow%3Avisible%3Bpadding%2Dleft%3A2em%3Bpadding%2Dright%3A2em%3Bfont%2Dfamily%3A%22OpenSans%22%2C%22HelveticaNeue%22%2CHelvetica%2CArial%2Csans%2Dserif%3Bfont%2Dsize%3A14px%3Bline%2Dheight%3A1%2E35%3B%7D%23header%7Btext%2Dalign%3Acenter%3B%7D%23TOC%7Bclear%3Aboth%3Bmargin%3A0010px10px%3Bpadding%3A4px%3Bwidth%3A400px%3Bborder%3A1pxsolid%23CCCCCC%3Bborder%2Dradius%3A5px%3Bbackground%2Dcolor%3A%23f6f6f6%3Bfont%2Dsize%3A13px%3Bline%2Dheight%3A1%2E3%3B%7D%23TOC%2Etoctitle%7Bfont%2Dweight%3Abold%3Bfont%2Dsize%3A15px%3Bmargin%2Dleft%3A5px%3B%7D%23TOCul%7Bpadding%2Dleft%3A40px%3Bmargin%2Dleft%3A%2D1%2E5em%3Bmargin%2Dtop%3A5px%3Bmargin%2Dbottom%3A5px%3B%7D%23TOCulul%7Bmargin%2Dleft%3A%2D2em%3B%7D%23TOCli%7Bline%2Dheight%3A16px%3B%7Dtable%7Bmargin%3A1emauto%3Bborder%2Dwidth%3A1px%3Bborder%2Dcolor%3A%23DDDDDD%3Bborder%2Dstyle%3Aoutset%3Bborder%2Dcollapse%3Acollapse%3B%7Dtableth%7Bborder%2Dwidth%3A2px%3Bpadding%3A5px%3Bborder%2Dstyle%3Ainset%3B%7Dtabletd%7Bborder%2Dwidth%3A1px%3Bborder%2Dstyle%3Ainset%3Bline%2Dheight%3A18px%3Bpadding%3A5px5px%3B%7Dtable%2Ctableth%2Ctabletd%7Bborder%2Dleft%2Dstyle%3Anone%3Bborder%2Dright%2Dstyle%3Anone%3B%7Dtablethead%2Ctabletr%2Eeven%7Bbackground%2Dcolor%3A%23f7f7f7%3B%7Dp%7Bmargin%3A0%2E5em0%3B%7Dblockquote%7Bbackground%2Dcolor%3A%23f6f6f6%3Bpadding%3A0%2E25em0%2E75em%3B%7Dhr%7Bborder%2Dstyle%3Asolid%3Bborder%3Anone%3Bborder%2Dtop%3A1pxsolid%23777%3Bmargin%3A28px0%3B%7Ddl%7Bmargin%2Dleft%3A0%3B%7Ddldd%7Bmargin%2Dbottom%3A13px%3Bmargin%2Dleft%3A13px%3B%7Ddldt%7Bfont%2Dweight%3Abold%3B%7Dul%7Bmargin%2Dtop%3A0%3B%7Dulli%7Blist%2Dstyle%3Acircleoutside%3B%7Dulul%7Bmargin%2Dbottom%3A0%3B%7Dpre%2Ccode%7Bbackground%2Dcolor%3A%23f7f7f7%3Bborder%2Dradius%3A3px%3Bcolor%3A%23333%3B%7Dpre%7Bwhite%2Dspace%3Apre%2Dwrap%3Bborder%2Dradius%3A3px%3Bmargin%3A5px0px10px0px%3Bpadding%3A10px%3B%7Dpre%3Anot%28%5Bclass%5D%29%7Bbackground%2Dcolor%3A%23f7f7f7%3B%7Dcode%7Bfont%2Dfamily%3AConsolas%2CMonaco%2C%27CourierNew%27%2Cmonospace%3Bfont%2Dsize%3A85%25%3B%7Dp%3Ecode%2Cli%3Ecode%7Bpadding%3A2px0px%3B%7Ddiv%2Efigure%7Btext%2Dalign%3Acenter%3B%7Dimg%7Bbackground%2Dcolor%3A%23FFFFFF%3Bpadding%3A2px%3Bborder%3A1pxsolid%23DDDDDD%3Bborder%2Dradius%3A3px%3Bborder%3A1pxsolid%23CCCCCC%3Bmargin%3A05px%3B%7Dh1%7Bmargin%2Dtop%3A0%3Bfont%2Dsize%3A35px%3Bline%2Dheight%3A40px%3B%7Dh2%7Bborder%2Dbottom%3A4pxsolid%23f7f7f7%3Bpadding%2Dtop%3A10px%3Bpadding%2Dbottom%3A2px%3Bfont%2Dsize%3A145%25%3B%7Dh3%7Bborder%2Dbottom%3A2pxsolid%23f7f7f7%3Bpadding%2Dtop%3A10px%3Bfont%2Dsize%3A120%25%3B%7Dh4%7Bborder%2Dbottom%3A1pxsolid%23f7f7f7%3Bmargin%2Dleft%3A8px%3Bfont%2Dsize%3A105%25%3B%7Dh5%2Ch6%7Bborder%2Dbottom%3A1pxsolid%23ccc%3Bfont%2Dsize%3A105%25%3B%7Da%7Bcolor%3A%230033dd%3Btext%2Ddecoration%3Anone%3B%7Da%3Ahover%7Bcolor%3A%236666ff%3B%7Da%3Avisited%7Bcolor%3A%23800080%3B%7Da%3Avisited%3Ahover%7Bcolor%3A%23BB00BB%3B%7Da%5Bhref%5E%3D%22http%3A%22%5D%7Btext%2Ddecoration%3Aunderline%3B%7Da%5Bhref%5E%3D%22https%3A%22%5D%7Btext%2Ddecoration%3Aunderline%3B%7Dcode%3Espan%2Ekw%7Bcolor%3A%23555%3Bfont%2Dweight%3Abold%3B%7Dcode%3Espan%2Edt%7Bcolor%3A%23902000%3B%7Dcode%3Espan%2Edv%7Bcolor%3A%2340a070%3B%7Dcode%3Espan%2Ebn%7Bcolor%3A%23d14%3B%7Dcode%3Espan%2Efl%7Bcolor%3A%23d14%3B%7Dcode%3Espan%2Ech%7Bcolor%3A%23d14%3B%7Dcode%3Espan%2Est%7Bcolor%3A%23d14%3B%7Dcode%3Espan%2Eco%7Bcolor%3A%23888888%3Bfont%2Dstyle%3Aitalic%3B%7Dcode%3Espan%2Eot%7Bcolor%3A%23007020%3B%7Dcode%3Espan%2Eal%7Bcolor%3A%23ff0000%3Bfont%2Dweight%3Abold%3B%7Dcode%3Espan%2Efu%7Bcolor%3A%23900%3Bfont%2Dweight%3Abold%3B%7Dcode%3Espan%2Eer%7Bcolor%3A%23a61717%3Bbackground%2Dcolor%3A%23e3d2d2%3B%7D" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Using the Open Tree synthesis in a comparative analysis</h1>
<h4 class="author"><em>David Winter</em></h4>
<h4 class="date"><em>2016-02-01</em></h4>
</div>


<div id="phylogenetic-comparative-methods" class="section level2">
<h2>Phylogenetic Comparative Methods</h2>
<p>The development of phylogenetic comparative methods has made phylogenies and important source of data in fields as diverse as ecology, genomic and medicine. Comparative methods can be used to investigate patterns in the evolution of traits or the diversification of lineages. In other cases a phylogeny is treated as a “nuisance parameter”, allowing with the autocorrelation created by the shared evolutionary history of the different species included to be controlled for.</p>
<p>In many cases finding a tree that relates the species for which trait data are available is a rate-limiting step in such comparative analyses. Here we show how the synthetic tree provided by Open Tree of Life (and made available in R via <code>rotl</code>) can help to fill this gap.</p>
</div>
<div id="a-phylogenetic-meta-analysis" class="section level2">
<h2>A phylogenetic meta-analysis</h2>
<p>To demonstrate the use of <code>rotl</code> in a comparative analysis, we will partially reproduce the results of <a href="dx.doi.org/10.1111/jeb.12282">Rutkowska <em>et al</em> 2014</a>. Very briefly, this study is a meta-analysis summarising the results of multiple studies testing for systematic differences in the size of eggs which contain male and female offspring. Such a difference might mean that birds invest more heavily in one sex than the other.</p>
<p>Because this study involves data from 51 different species, Rutkowska <em>et al</em> used a phylogenetic comparative approach to account for the shared evolutionary history among some of the studied-species.</p>
<div id="gather-the-data" class="section level3">
<h3>Gather the data</h3>
<p>If we are going to reproduce this analysis, we will first need to gather the data. Thankfully, the data is available as supplementary material from the publisher’s website. We can collect the data from using <code>fulltext</code> (with the papers DOI as input) and read it into memory with <code>gdata</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gdata)
<span class="kw">library</span>(rotl)
<span class="kw">library</span>(fulltext)

doi &lt;-<span class="st"> &quot;10.1111/jeb.12282&quot;</span>
xl_file &lt;-<span class="st"> </span><span class="kw">ft_get_si</span>(doi, <span class="dv">1</span>, <span class="dt">save.name=</span><span class="st">&quot;egg.xls&quot;</span>)
egg_data &lt;-<span class="st"> </span><span class="kw">read.xls</span>(<span class="dt">xls =</span> xl_file)
egg_data</code></pre></div>
<pre><code>##                           animal                      Spp        Lndim
## 1         Zonotrichia_leucophrys    White-crowned sparrow  0.000000000
## 2              Passer_domesticus            House sparrow  0.009407469
## 3                Serinus_canaria                   Canary  0.000000000
## 4                  Turdus_merula       European blackbird  0.021189299
## 5            Agelaius_phoeniceus     Red-winged blackbird  0.218316086
## 6            Quiscalus_mexicanus     Great-tailed grackle  0.281894985
## 7            Taeniopygia_guttata              Zebra finch -0.010812869
##    Measure Neggs Nclutches          ESr Type              StudyID Year
## 1   volume   294        73  0.140045943 stat             Mead1987 1987
## 2   volume   149        31  0.111752030 stat          Cordero2000 2000
## 3   volume    52        21  0.496791400 stat          Leitner2006 2006
## 4   volume    82        54  0.385985400 stat          Martyka2010 2010
## 5   volume   394       106  0.074101360  raw      Weatherhead1985 1985
## 6     mass   822       205  0.051788336  raw          Teather1989 1989
## 7     mass   116        24 -0.056362130 stat        Rutkowska2005 2005
##            D         EN           Zr         VZr
## 1   3.421918  85.916733  0.140972438 0.012060292
## 2   4.045161  36.834131  0.112220753 0.029555954
## 3   2.180952  23.842795  0.545037117 0.047978211
## 4   1.414815  57.958115  0.407073970 0.018195675
## 5   3.173585 124.149822  0.074237439 0.008254242
## 6   3.407805 241.210993  0.051834710 0.004197959
## 7   4.066667  28.524590 -0.056421926 0.039177906
##  [ reached getOption(&quot;max.print&quot;) -- omitted 58 rows ]</code></pre>
<p>The most important variable in this dataset is <code>Zr</code>, which is a <a href="https://en.wikipedia.org/wiki/Fisher_transformation">normalized effect size</a> for difference in size between eggs that contain males and females. Values close to zero come from studies that found the sex of an egg’s inhabitant had little effect in its size, while large positive or negative values correspond to studies with substantial sex biases (towards males and females respectively). Since this is a meta-analysis we should produce the classic <a href="https://en.wikipedia.org/wiki/Funnel_plot">funnel plot</a> with effects-size on the y-axis and precision (the inverse of the sample standard error) on the x-axis. Here we calculate precision from the sample variance (<code>Vzr</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dv">1</span>/<span class="kw">sqrt</span>(egg_data$VZr), egg_data$Zr, <span class="dt">pch=</span><span class="dv">16</span>,
     <span class="dt">ylab=</span><span class="st">&quot;Effect size (Zr)&quot;</span>,
     <span class="dt">xlab=</span><span class="st">&quot;Precision (1/SE)&quot;</span>,
     <span class="dt">main=</span><span class="st">&quot;Effect sizes for sex bias in egg size among 51 brid species&quot;</span> )</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkAAAAEgCAMAAABrWDzDAAAC/VBMVEUAAAABAQECAgIDAwMEBAQFBQUGBgYHBwcICAgJCQkKCgoLCwsMDAwNDQ0ODg4PDw8QEBARERESEhITExMUFBQVFRUWFhYXFxcYGBgZGRkaGhobGxscHBwdHR0eHh4fHx8gICAhISEiIiIjIyMkJCQlJSUmJiYnJycoKCgpKSkqKiorKyssLCwtLS0uLi4vLy8wMDAxMTEyMjIzMzM0NDQ1NTU2NjY3Nzc4ODg5OTk6Ojo7Ozs8PDw9PT0+Pj4/Pz9AQEBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBRUVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7////zRGfuAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAaXklEQVR4nO2deXwURdqA3yQkMRfhEBCiRhJuWBARUFE5ooKg4gWIKB4oiqio4OInEj6WXRECivqtoKARD24RNiAKCKKyHoCiCB+wC8uhqBwiV8AkU7+t6u6ZqZnpnunqqp5MJu/zx0xPT/Vbb1U90109VwNBEAmgshNAqjYoECIFCoRIgQIhUqBAiBQoECIFCoRIgQIhUqBAiBQoECIFCoRIgQIhUqBAiBQoECIFCoRIgQIhUqBAiBQoECIFCoRIgQIhUqBAiBQoECIFCoRIgQIhUqBAiBQoECIFCoRIgQIhUqBAiBQoECIFCoRIYVugCeBlEH30buOkRoTMyk1qJlTbLQBlNovqNUiRD61t1yyQWXiUBQpDRZo+EjP1h71gle8pvs2hGX0BMNFJhWEa5Uygg6kAdcneJIBci+Ibxo3bKZRIEHoNcsStQPuAF2hjYlUR6PpxGu8R8hnA3fvICoCH9lsUnw6wInTtyHbtbPauXoMcfGdGqtl+ZhFQFigMa6CxNhKb6PKZdxtAeIG4jJwKFKZRIgLN9D1YBfAyIe8DFFsVNxfIPnoNcph0ZnzwKtzpXbw7ke2KwgrE4VSgMDgSqMB3OINUQrb3z8u+8u8e9sThh9qlNx9+yCjR2Sj+YcE5GW2eomtJT1p+rbFlOxKwqb+Qv4YyUjru0prnX/sRW9UBck7clbUvOKQ/xlKApmXkA4D8U3oh2pmfXl3zvAkVRs3Es/Dy+mlNh+8LrU9/nlax7+ass2/a7Ws1l+Avg3Py/rxZ7wV+2X4TGVwKzaH11quyL37es/CyjJavsRKBrfWnElzdKCj0xusLIQL52mz0mNY0smdAw7xHP+UE8qecAx2+7ZLWrrAsqMW+0dR7x3y0HAl0Z0M6QcnPp/vOei3JxxlaG26mgXc30hbPPUzuPBvgnFv00m/rvdnyWEjvcptyhfw1lB1qqa9+Wu+OfgD7gkNyMW4EmO3pBPCRrzPrpmuTNo/RBdP0zZodC6nPK1CdplqBM8ZaLviPjbXXhNYL/LL9JmpwKTSHOnXY8k0J7HYhIYGt9acSUl1fuL9LRstRxuvk5UCB/G02ekxr2rb6bG0rv0BcyjlwQV223KuCmI+m3jvmo+VgEn0g4BBW1grOL9k4GGAxIQMBhi5+GGBYwCEsF2rNXnYfwBQ9kSOrVq1a2Qbg/oBNuUIaeg3DALrPfaEWJHzLuqMG1G97ICgkH2NPBuQvARjo70xIG1d0DsBKveayTMh9Yd5VAEtD6zMEggbjnqVdXaKv5IPTVB5dXwjaKPLL9puoReRSaE4Nm9yLRmk/+RqAG4Jb608lpLrW+kB0LDMTyN9mo8e0pl0P0Gc6fYX5BOJSzgHImjCF6vKe1WhqvWc+WtICfQQwj3ZMDlxJjlCJ6TlmU2jMC3SCvniOEs/Qu1717goJmQJw4Sl+U76QX6CTidC8TFseonXp2IqQkFwMQqYCZEL2Aa4z6XN0199br3lvnz608StZu0Pq8wr0PSFvAUzVV/IJJsMVdM1QNor8sv0manApUIFq/ExOZULKr+RkJvwppLXeVEKqqzgLzileQvdIM0wF8rXZ6DGW0S6ArhXEc41PID5lKtByQrYAXG01miyExWiJCNR7jMaxAIFeoju5/Pz8s6A+2QgwjZb8ccsWDydQRT2As/q88h/fMNGdYSLU2UX4TflCfoG+AxhPlz0N4HLt9eQ9snCluRi0de2o39O5zswop3cXw7nemis2Tn/wfICi0PoMgerRxa8AJugrueDfAkyma1azUeSX7TfRm7s3BSpQnpZkM6LPfYNa60slpLrTb7/9AyEHUpgkoQL522z0GMtoOcDrRDv0TAxNOQfqsiPshXC+1WiyEBajJX0WNsq3ZzpOH8/2luAOYWubaE8X7PX27p6zIeFDQvhN+UL+GpYZdV6kd4f/jUV/aT4GIa/RnfFprjPz2d3NbDau1TyXztqgtjZ6wfV5J9F0cYNPIC74Ev2McyvLiF8WaKIGl0JzaE68p03sNqi1vlRCq9NprQkYIpC/zUaPsYyM4VjjP4RxKefoZ269oYbHYjRZCIvRkhZosrav1fjCt+8PPI2vWDcil1bXw+jdUrpr/Rtbz23KF/LX4H1NngOXeLs0uHRAjFN0Bw7PcZ2ZzV5ZV7AXM6t5WxI0n77tc230guszFYgL/rne9StZL/DLIk2k8CkEC2TSWi2VkOr2rF3L5v7NoK32MEggf5uNHmMZUQnfoItzuLMwf8rGHqg9PVhZjCYLYTFa0gLRm1l0zXeffUkO0kmgh3h65VykHcI+MBIZPnwL8azPgQw9Ec/dAH21yQy3KV/IXwOdFbQo07rungCBuNJcDEKeAagPabv8nQmfEvJTCptCsJpnACzRJidFofWZCsQF/5nOdcuJZwDrBX7ZfhM1uBRCBDJprZZKSHVzAeZSFxON04XgOZCvzZxA2/Wh6e0TiE9ZnwNp8yaL0WQhLEbLwTvR4wMEOpkDjRZ/+UIKa/UNtO3zB7OzDzKTvgT1k4RN9HTh3U9m1mYntSyR1wEyFtHTlNX8pnwhTtEHqeTz6HlJ4qYAgbjSfPVbk6HtOjr1854y087MXbr6YoA5es1vAvScPzmDjV5IfaYC8cF70v6d0U8/FeKXbTdRg0shRCCT1uqpBFe3JwXqFI5vCLDGVCBfmzmBCD3xu376zf6zMD5lKlDNv7Iztw+tRpOFsBgtB2dhSYHvRL+XrK1t8SMh2+tpi40PE/IpeN9I9Aw0tntHT+QBfxj/pnwhTqBDLfS1hSRAIL40F+NKdnZ8jXayYHRmivZcT+NUZG8me0SPLmNC6zMViG/bpiy2lKONIr9su4kaXAqhAoW2Vk8luDp2tskYQcwE8reZF+ib2mxtQ59AfMo50ED7dLa/x2o0tRDmoyUvEPnm+vPSW/3vEVbol/tap7V4nC16njrb+070mVldGiaf22sFCeldblOuECcQKR3bOeu83qtJoEABpX0x3qCvCw/5EqDBEW9nti65NKvNuDJvL667JL3d5KPJUOtUSH3mAvFt23p9vdzhX+ujyC/bbqIGl0KIQKGtNVIJro582P3segXGW0vBAvnbzAtEtt96Tu6DH/vnQFzKOdBhZdea7Z6tCGqxfzT1EKajhd8HEoKexvzDbDnKVauFCuR8YxTIHidrpubsI7/1gMSfApajXLUroEDR4GmAhKbpAJOClqNctRugQNHAs6CgUcoFvVd5gpajXLUboEBI5YECIVKgQIgUKBAiBQqESIECIVKgQIgUKBAiBQqESIECIVKgQIgUKBAiBQqESIECIVKgQIgUKBAiBQqESIECIVKgQIgUKBAiBQqESIECIVKgQIgUKBAiBQqESIECIVKgQIgUigV6ogMSF1z+c+UIdEnxRikAQC4Aooam31WSQF/IbK3/r5eqXBAJ2lZhgdCgGAAFQqRwJJDn2DHZ/zBCgeIEYYE8ax5vnwaQdtHja2QkwjlQnCAoUEVx84YDp76/bt3iqQMbtnizwnG9cgIRFChWEBTosgFry71rytcO6OK4XicCoTQxiKBA2wjZedi/cpvjeh0IhMetWER8El3rYRX1iguEE+eYRFygwsYnFNSLAsUJ4gLNKch94rkiilS9KFCcIC5QrhepenEOFCdUpXei0Z8YRFCgEl/x3Qul6pV8HwiJFQQFgqTnjDcPi+V2BihQnCAqUGPofUhbqmIC4cHPJUQFemNG6nna2FcpgXD+7RqiAhWTb/JrTPNUSYHQIBcQF4gcvQVuPooCIRoOBCKeF5PzNjkSaL3vu9jJsxxs7hgUyDWcCETIV7kpPZ0Mx2nfd7HTZ0YurQ70xzWcCUQOXy85HplRFQi/P+QaggLt836Q6pkxUqreKAuEuIWgQNNP8+tOv+K4XkcC4W4k9hAU6H/yxv5gfBXas+WZvKcd1+tEIJzJxCCiH6ZufzCzwXWPFBY+0rt+1rAdzut1LhAaFFOIfxp/vGRkn46drhtVclymXhQoTqisr3OgQHFC1RNIbR6IJFVJIE0htWkgslQtgZCYAwVCpHAk0B+7SyP9Lr5s10nt/sQB8+dRoDjBgUCz8xNh2+C/hVOofHwapDz2B10qsthzoUBxgrhA78CdJcnb3kl9MUzhFxMeXfhY0iCCAsU94gK1vpuQ1G3kyZZhCrcaTth3FhejQHGPuEBp8zWB5qeFKZw2l93ekleKAsU74gJd+Igm0Ni2YQo3f4zd7qt1rydKAuEbRJWFuEAz4cktKZ/MSg83B5qSMHTJKULmw5Bh0RAI36KuPMQF8kzJpqOVXhjuLKxsYi1g/x20oL7VuLogkBOD0DxZnLwPdOzLhet/i1Dcs7+U3Z1Z/Zr58yoFAscC4cez0ogLdEAzgxx+39Zmxy1MUygQoECViLhA0HwLu/vCXrcXBBTbMdpLSrgplBjO/UGB5HEgUIu0N4ltgaYM4R/tf85L6v/ZTjFSYihQZeJAoPUTEu87ZVcgK5QfwqK9KaLjQKAvyOp67XZGFMjz++EwJ2ouCiQkBfojiSOByP4uWU+G7fido5ukAqTk/flfFgUcf6FMH/DAYQ94JH5YihWJYiUPIZwJRP4YGbaxX9dsNHTaW7NffCg3e5N5Cce/C2O9HNYQYYFi5DgWI2mIIi7QFv2LPsvHhSncravxk43TfXuYl5ARKPy0WVSgWJlIx0oegrjzjcSavv/eKMk2L6FEoKCZT0Ah0aAO0gkf0tFGcS/QXZNIkZcwhTsO8s6fH+9kXkKxQNwaZ0cwlQPnLGL1EAgKbP1P9IKEgpnrt2775xvXJVr8mauEQLxHgc8YqwSHIaYEUphGdBAU6Pgpe6WXddf7o/syiwIyAvH7m4BnTI5sdqM6yCZCms6OYSrziApO5kD08LRj+cEI5Q99t3Ll5kOWT8v+MjW8QJU7DrGQQ9QQF2jv1feSj5Kg9kapeqV/2hw4RqECKRzByt+nxTDiAt2Ys4R07f7vrr2k6rUrUMhbzOZ7IJP5tbIxdHZUVFN37CMuUO3nybHExWRGXal67Qlkagkxm0WbK8Q95zjTanVAEkdcoOxXyftJR8jMDKl6nQsUqEpwWVOBwhgQ2Q2FAsWjiuICXd15fcce5HD3DlL12hLI/FBkcZSyFiiMAjaGVJlAJjnHAeICbW4A6Z+T/JQSqXpF9kBhBLJYLSiQHYOC1tjJ3ryuai8QObnhV0IW7ZSr19EhjF9pfwckK1DwYc6pBSiQSmyehYUVyHSltVuW8Z2cpDvQAAVSicwXyiLtlsztsg4l2DRZgeLrLL/KCBQwaCYjaKlPhNEWH0wrgSJqZWwXX/shcYF+K9fu/jgqVa8zgcDsAbfG8vDlcLisRbG92jxodRYI9Onz6iwHtR1dtMAgbYbYlgG9brGbsdz/OB2vMKpEyDByVLl3Nh1vrBxBgeb27QsFfRlNmziobVM/LzWmiG1pUyCLzZx1udCW9uuRFCjG9l+CAr03aBDcMIgxeIVUvWEPYSY9FNjroVqEPa7ICSRkkP2wDhJSsblqxA9hnfeqqNdaIIthMxcozKwoqKSDHMW2tF9YToAqLxA58PoRsn+SpEaWAlnuMwLWcAZxhzWTDST8ET5aRGdUq7xAX9ZO20921cv+WqpeK4FC9y2WCYUvqKSbbYWI8nBWrj8hFYsLdMWVv9Pb0mu7SSWiUiCH7zEH79KMhQjVWlQkupUEleiPSVPFBcqYp90tcHIa7yeyQJEzkhIo8GnvAwc2xNghxU3MmiouUBP99zyT8qVyiSiQjYwUCGQU8hV2R6B4EUyNQM9kzjlDyhZmPSmVS/hJtK2E1AkUKpIAkbeJm12UGoHKhiQknJ0E/U+HKx2RMO8D2evqCP7Y+QxMpUCRMxUKGpuoEYiQHe9MLN4Sobgr18rg04+gj71YwQI5/nTeTk0OE40lTNrhzsVW3LlWRsA4yApEAnY53khujHT8+EOUnMbbudiKO9fKAFODTEqJhgxYI56XeCVxhDsXW3FwrQzxTyFNx0V4sKIxsnHsj0sXWxG+VoatYecON5HKINHCnYutiF4rw940IXC+G7ZMhEiIMty52IrotTLsDnvkM20UKMq4c7EV0WtlCAy7LYHsBEKU4M7FVkSvlaFOIFdOxBFr3LrYiheb18oQGPawAqE90UZQoM+OkrU2/6RMp8DeWZjI+y8R/EGDooqgQCmLvL/KsEngtTL8uHPJS5xCRx1BgS5NzYfz8nWcVHfECwoUJwgK9MtLE2HkRJ0IG5hdK2NtbS8JfxdM1F6SKFC0ERRoT6m9Q1jEa2Vc8oXNeoVAf6KO6BxouS2BIl8rwx2B8Cws6ggK1KZBAVxaoBOmcORrZbgkEBJtBAX6/ycegNse0AlTOPK1MlCgOEH8jcSeP0YuHPlaGdEWCCdHLuHO/wNFvlZGlAXC0zO3EBRoDJ0Tn1nBLnOwtF240hGvlYECxQmiV+spJuQgrCLs+4bhy0e4VgYKFCe4JhClfOR+y+dQoDjBTYHK4FvL53ASHSdUF4HEfqyB2KbaCIS4g5sCVaw6Zvmc6wLhDic6iAqUUbdubciqW7duhtwAuSwQTnmihaBAIzik6nVXIDzpihqV9U/1KFCcgAIhUqBAiBTxKRBOoqNGpQn01KtK6HmHBWD1RGSuvdX5tlb066U+5h3dXYh57XixAcipJIFmDlVDQouWyqmZoz7muVnqY7YEF2LW7CI2AI/+XjkCqaJGmfqYt81VH3PRLepjkoTwPy93RP/56mNqoEBSoEAokBQoEAokBQqEAkmBAqFAUqBAKJAUKBAKJAUKFKMCZZSrj3nHIvUxlw5QH5OkuSDQ7YvVx9SIUYGsfzjknKMu7NXKjqqPWWUarxGjAiFVBRQIkQIFQqRAgRApUCBEChQIkQIFQqRAgRApUCBEChQIkQIFQqSIRYFKdzMOVnYa9qgyybqUaCwK9J72+0GL6wE5Y9RI7W5h5+weG9TGVJls+dSW6W1eZl9EUJeoL6YLvcqIRYGKGr1P+UZhxJ11tMFelnj7zCuyha5rFTGmymQnJjw6Z1jCeKWJ+mKq71WNWBRoWLjLLThg3eU1QBvs7j085FjD0UpjKkzWU/t+evtIWpnCRP0xVfeqQSwK1PN+ovTbK1uKirS9xSFgV3od2kRlTJXJ7ocl9HYh7FKYqC+m8l41iEWBmnZtltC4SOl3EvPZYH8H6+nttFRFX/jTYqpMtnQbu+zoYyknFSbqi+lGrzJiUKDy5DovLxsGf1EZUxvslbCV3r4Fdn/2bSem8mSLk0aoTlSL6UavMmJQoNNz2eXs7k1X+WIxBGIXvZ8Nir4yqsVUnOz+W+H2M4oT1WO60auMGBRIZzHsUBhNG+zN8E96+2KK0kOYhqpkF9TKY19+V5qoEVNHba8yYlCgvSsq6O0S+FlhzHx9El1Mb4fnqYypNNmFcG8pu1eZqDemG73KiEGBNkMJvR2Sq/LHLfreott19JhzwZMqY6pM9kz9IUYYdYn6YrrRq4wYFMjTq07RnHtA6a+4dIGWJTyx7MZsqwsGO4qpMtmPYVgR44TCRH0x3ehVRgwKRH4b1ijj0g+UhjTmK/Mvrtl9o9qYCpN9zfgT0QMKE/XHdKFXGbEoEFKFQIEQKVAgRAoUCJECBUKkQIEQKVAgRAoUCJECBUKkQIEQKVAgRAoUCJECBUKkQIEQKVAgRAoUCJECBUKkQIEQKVAgRAoUCJECBUKkQIEQKVAgRAoUCJECBUKkQIEQKaqxQCPZT37TOy6xev443GW6HMLTr7Bb449gSeFMsvGGnLRWow/TByOMXxaPIVsvq1CTdoxRnQVKKy4uLmoNH1s8f6pgkulyMDvyThPfn7YScuEvXyZ3fGXumDod6OoRGcUamwgZUKwu9RiiOguUzW5/q3OjZJwHx3J/2kr+dQXp24z9I88G9k8YI+r6iq1p7sLFmCufai8QKWhNSO6ccbV3emZdlP6nd+masrHNMq/8iq4tImRzz1p1btqrL5dPaJmpHfFy3y5qWbPfYT3M8cwfuD9tJVOeJy1v1ZZGfRggUHnDNVFsXNSo9gKV53WnRlx1wUOHp8LD8wbDW4QMyZw874raB5g0Jxt0fnVKo6t1gYbXGDNvICymD7rcsPzllIf0MCUN9D2L8Q8yXXaRO1InGXKREbUPapyhywMfj3YLo0F1FijrwIEDPwyFl6gRuSfI8Wz2j2B35JOdiXMIOZr2OpNmA/vD3SX3etjyvhrPE+Lp3Y4Wb1FOyF2djDB99HtdoJ87EPJrH0i+8i8bmFfeSfQKujy1faU002Wqs0D62N5TRo14gpCvYAtdWZL4xzsJbH+x/wiT5pf0TkuOscJ0eTn75ycyO+E0yWWqje6gh+nziH6vC/TaeHb741t3NYAuP1GBslZpsGucLE6Lx0lQdRYofcWKFSv3scXc5whZBCmpqanJsHuid97CDlufd0tM6rZSW56ZwE7EV8J/SO5k4heoY6F+rwt07fekopSVO/N2Zr+AORBZB8ei0q7oUp0FyvYtaqrAJ9sYpcVJ7JIAu/Zrawk5srh70k62vEzbA70Np/QnvAJ1KtTvNYF+b+UhO2GltmJIDgoU1wQJdCRtFl16Z7Dne1hISGm9SWztoiZ0OvxvWK7NgZJeYHOgNiRQoOv4Q9i8UYRU1LqB7YL+aN8tUCA8hMUZQQKRsemFC0af9VdC+mcVLexdcw9buzOlYNar3Wod1Eo8lDzWOAvjBRrFT6IHsItcvAttJ8x6tn2Ntf43EpcSnETHHcECeaa1SWsxje4lTo/My+xqvA/0j4vS61yzQV8uG98iQ38fiBeopL7/NP50M+3zirW9clLz+28i/rMweuqGp/GIKcczt9gqh28kIuY8+IytYmvxowzElO3ah6kRuQ0/TEXM0b/OEYFt+HUOBAkFBUKkQIEQKVAgRAoUCJECBUKkQIEQKVAgRAoUCJECBUKkQIEQKVAgRAoUCJECBUKkQIEQKVAgRAoUCJECBUKkQIEQKVAgRAoUCJHivywCVvnHmRScAAAAAElFTkSuQmCC" alt /></p>
<p>In order to use this data later on we need to first convert it to a standard <code>data.frame</code>. We can also convert the <code>animal</code> column (the species names) to lower case which will make it easier to match names later on:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">egg_data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(egg_data)
egg_data$animal &lt;-<span class="st"> </span><span class="kw">tolower</span>(egg_data$animal)</code></pre></div>
</div>
<div id="find-the-species-in-ott" class="section level3">
<h3>Find the species in OTT</h3>
<p>We can use the OTL synthesis tree to relate these species. To do so we first need to find Open Tree Taxonomy (OTT) IDs for each species. We can do that with the Taxonomic Name Resolution Service function <code>tnrs_match_names</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxa &lt;-<span class="st"> </span><span class="kw">tnrs_match_names</span>(<span class="kw">unique</span>(egg_data$animal), <span class="dt">context=</span><span class="st">&quot;Animals&quot;</span>)
<span class="kw">head</span>(taxa)</code></pre></div>
<pre><code>##            search_string            unique_name approximate_match ott_id
## 1 zonotrichia_leucophrys Zonotrichia leucophrys              TRUE 265553
## 2      passer_domesticus      Passer domesticus              TRUE 745175
## 3        serinus_canaria        Serinus canaria              TRUE 464865
## 4          turdus_merula          Turdus merula              TRUE 568572
## 5    agelaius_phoeniceus    Agelaius phoeniceus              TRUE 226605
## 6    quiscalus_mexicanus    Quiscalus mexicanus              TRUE 743411
##   is_synonym is_deprecated number_matches
## 1      FALSE         FALSE              1
## 2      FALSE         FALSE              1
## 3      FALSE         FALSE              2
## 4      FALSE         FALSE              1
## 5      FALSE         FALSE              2
## 6      FALSE         FALSE              1</code></pre>
<p>All of these species are in OTT, but a few of them go by different names in the Open Tree than we have in our data set. Because the tree <code>rotl</code> fetches will have Open Tree names, we need to create a named vector that maps the names we have for each species to the names Open Tree uses for them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxon_map &lt;-<span class="st"> </span><span class="kw">structure</span>(taxa$search_string, <span class="dt">names=</span>taxa$unique_name)</code></pre></div>
<p>Now we can use this map to retrieve “data set names” from “OTT names”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxon_map[<span class="st">&quot;Anser caerulescens&quot;</span>]</code></pre></div>
<pre><code>##  Anser caerulescens 
## &quot;chen_caerulescens&quot;</code></pre>
</div>
<div id="get-a-tree" class="section level3">
<h3>Get a tree</h3>
<p>Now we can get the tree. There are really too many tips here to show nicely, so we will leave them out of this plot</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr &lt;-<span class="st"> </span><span class="kw">tol_induced_subtree</span>(taxa$ott_id)
<span class="kw">plot</span>(tr, <span class="dt">show.tip.label=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="data:image/png;base64,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H8DiASwewOJlAH52rbnLzhb3yQHOvwzAlx9nbrDk4dkwwPmn/jx45BlntndjX2/8fbpqReKywjmLfSG0ALh/a5vXMcRP8Iy+xIXB8y71hdAC4LZvqCU65T5ZpVqi274MwEuPNIu7h4Ua4PzLAPzWo2Zxf8l9coDzLwOwvwDOP4DFA1i8usAvdZjzcyY+lPjIf17ZGbXLfXKA868u8ItfMufnfOWpxEd6JnVFebjYAeD8qw98gnnD8+CS1xTwLzdGh5EuusrX5ADnX1PA+y+IDiPN+I6vyQHOv6aAy7TFO8CVMgCvONUcVLrHfXKA828o4NkbdlY7zAA/tsIcVLrffXKA82/Ky3X23Hh6hvn49M6uaqPf9Ds5wPk36aA6e24ccFDyk8u0AzjAQzS4RNcEsFAAi5cGPGFq7P+QT3efA+CApQG/G/uNeue/3ecAOGBpwL4DOGAAiweweC90DXFG9XPucwAcsB1dQ1wT0eM+B8DiASwewOIBLF6ewDcc1U1OrXJHyBP41Xv6yakn3RHyBKYCBLB4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweACLB7B4AIsHsHgAiweweP8HLNSGDDe8OHkAAAAASUVORK5CYII=" title alt style="display: block; margin: auto;" /></p>
<p>There are a few things to note here. First, the tree has not branch lengths. At present this is true for the whole of the Open Tree synthetic tree. Some comparative methods require either branch lengths or an ultrametric tree. Before you can use one of those methods you will need to get a tree with branch lengths. You could try looking for published trees made available by the Open Tree with <code>studies_find_trees</code>. Alternatively, you could estimate branch lengths from the toplogy of a phylogeny returned by <code>tol_induced_subtree</code>, perhaps by downloading DNA sequences from the NCBI with <code>rentrez</code> or “hanging” the tree on nodes of known-age using penalized likelihood method in <code>ape::chronos</code>. In this case, we will use only the topology of the tree as input to our comparative analysis, so we can skip these steps.</p>
<p>Second, the tip labels contain OTT IDs, which means they will not perfectly match the species names in our dataset or the taxon map that we created earlier:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr$tip.label[<span class="dv">1</span>:<span class="dv">4</span>]</code></pre></div>
<pre><code>## [1] &quot;Tmarus_caeruleus_ott3549301&quot;     &quot;Anseranas_semipalmata_ott714464&quot;
## [3] &quot;Aythya_fuligula_ott817992&quot;       &quot;Aythya_affinis_ott1044556&quot;</code></pre>
<p>Finally, the tree contains node labels for those nodes that match a higher taxonomic group, and empty character vectors (<code>&quot;&quot;</code>) for all other nodes. Some comparative methods either do no expect node labels at all, or require all labeled nodes to have a unique name (meaning multiple “empty” labels will cause and error).</p>
<p>We can deal with all these details easily. <code>rotl</code> provides the convenience function <code>strip_ott_ids</code> to remove the extra information from the tip labels. With the IDs removed, we can use our taxon map to replace the tip labels in th tree with the species names from dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">otl_tips &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>, <span class="kw">strip_ott_ids</span>(tr$tip.label))
tr$tip.label &lt;-<span class="st"> </span>taxon_map[ otl_tips ]</code></pre></div>
<p>Finally, we can remove the node labels by setting the <code>node.label</code> attribute of the tree to <code>NULL</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr$node.label &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
</div>
<div id="perform-the-meta-analysis" class="section level3">
<h3>Perform the meta-analysis</h3>
<p>Now we have data and a tree, and we know the names in the tree match the ones in the data. It’s time to do the comparative analysis. Rutkowska <em>et al</em>. used <code>MCMCglmm</code>, a Bayesian MCMC approach to fitting multi-level models,to perform their meta-analysis, and we will do the same. Of course, to properly analyse these data you would take some care in deciding on the appropriate priors to use and inspect the results carefully. In this case, we are really interested in using this as a demonstration, so we will just run a simple model.</p>
<p>Specifically we sill fit a model where the only variable that might explain the values of <code>Zr</code> is the random factor <code>animal</code>, which corresponds to the phylogenetic relationships among species. We also provide <code>Zvr</code> as the measurement error variance, effectively adding extra weight to the results of more powerful studies. Here’s how we specify and fit that model with <code>MCMCglmm</code>:</p>
<pre><code>## Warning in inverseA(pedigree = pedigree, scale = scale, nodes = nodes): no
## branch lengths: compute.brlen from ape has been used</code></pre>
<p>Now that we have a result we can find out how much phylogenetic signal exists for sex-biased differences in egg-size. In a multi-level model we can use variance components to look at this, specifically the proportion of the total variance that can be explained by phylogeny is called the phylogenetic reliability, <em>H</em>. Let’s calculate the <em>H</em> for this model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">var_comps &lt;-<span class="st"> </span><span class="kw">colMeans</span>(model$VCV )
var_comps[<span class="st">&quot;animal&quot;</span>] /<span class="st"> </span><span class="kw">sum</span>(var_comps)</code></pre></div>
<pre><code>##      animal 
## 0.002340708</code></pre>
<p>It appears there is almost no phylogenetic signal to the data. The relationships among species explain much less that one percent of the total variance in the data. If you were wondering, Rutkowska <em>et al</em>. report a similar result, even after adding more predictors to their model most of the variance in <code>Zr</code> was left unexplained.</p>
</div>
</div>
<div id="what-other-comparative-methods-can-i-use-in-r" class="section level2">
<h2>What other comparative methods can I use in R?</h2>
<p>Here we have demonstrated just one comparative analysis that you might do in R. There are an ever-growing number of packages that allow an ever-growing number of analysis to performed in R. Some “classics” like ancestral state reconstruction, phylogenetic independent contrasts and lineage through time plots are implemented in <code>ape</code>. Packages like <code>phytools</code>, <code>caper</code> and <code>diversitree</code> provide extensions to these methods. The <a href="https://cran.r-project.org/web/views/Phylogenetics.html">CRAN Phylogenetics Taskview</a> gives a good idea of the diversity of packages and analyses that can be completed in R.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
